省流：记录一下大数据中常用的几种文件存储格式，包括Parquet，ORC，Avro。

<!--more-->
# Parquet and ORC

## 行式存储与列式存储
列式存储常用的存储格式。
首先来回顾一下行式存储。
![](DevNotes/Blog/文件存储格式/Pasted%20image%2020230824155911.png)
当我们有这样一些数据时，以行式存储时，会将每一行数据存储到一起
优点：
- 顺序扫描时只要知道一条记录的位置，可以方便的从后续开始读取
缺点：
- 在做OLAP分析时，只需要其中的某几个字段，而扫描全量数据会影响效率。

那么列式存储是怎么做的呢：
![](DevNotes/Blog/文件存储格式/Pasted%20image%2020230824154843.png)
会将每一列数据存储到一起，并且由于每一列的数据类型肯定是一样的，那么可以进行更加高效的数据压缩
优点：
- 在查询时可以只读取所需的字段，减少IO数据量

但是需要注意的时，Parquet与ORC并不是纯列式存储，而是以行组形式进行存储
![](DevNotes/Blog/文件存储格式/Pasted%20image%2020230824160536.png)
以上面的数据为例，首先会对数据按照某些规则分组(比如这里每3行)，然后这一组的数据是存储到一起，在这组数据里面再按照列进行单独存储

## Parquet

### 文件结构
![](DevNotes/Blog/文件存储格式/Pasted%20image%2020230824160859.png)
在一个文件中，存在多个`Row Group`, 每个`Row Group`中的metadata存储了该`Row Group`中的每一列的开始起始位置，在每个`Column`的metadata中，存储了当前列的一些统计信息，在查询时可以通过这些信息判断是否需要读取这个文件块。在数据查询时的谓词下推就是利用这些统计信息来加快查询速度

### 字段兼容性



# 参考
- https://parquet.apache.org/docs/
- https://orc.apache.org/specification/ORCv2/
- https://bbs.huaweicloud.com/blogs/282511

