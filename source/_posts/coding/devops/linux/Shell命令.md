---
title: Linux-Shell
date: 2020-06-20 19:33:15
tags: 
- devops/linux/shell
---

Sha-Bang

```bash
#!/bin/bash # 以bash运行时，被当作注释，以其他方式运行时指定以bash运行
```

# 执行命令

-   bash ./filename.sh

新启动一个子进程来运行脚本，没有运行权限也可以运行

-   ./filename.sh

新启动一个子进程来运行脚本，需要运行权限

-   source ./filename.sh

在当前进程来运行

-   .filename.sh

在当前进程来运行

# 隐藏输入数据

```bash
#!/bin/sh
echo -n "Enter token: "
read -s HTTP_TOKEN
echo ${HTTP_TOKEN}
```

# 内建命令与外部命令

-   内建命令不需要创建子进程
-   内建命令对当前Shell生效

# 管道与重定向

## 管道

管道和信号一样，也是进程通信的方式之一

管道符是`"|"`，将前一个命令执行的结果传递给后面的命令

## 重定向

一个进程默认会打开标准输入，标准输出，错误输出三个文件描述符

-   输入重定向符号`"<"`
-   输出重定向符号`">", ">>", "2>", "&>"`
    -   `">"` 覆盖原有内容
    -   `">>"` 在最后一行进行追加
    -   `"2>"` 错误输出
    -   `"&>"` 信息全部输出

# 变量

## 变量定义

变量名的命名规则：

-   字母、数字、下划线
-   不能以数字开头

## 变量的赋值

为变量赋值的过程，称为变量替换，等号两边不能有空格

-   变量名=变量值
    -   a=123
-   使用 let 为变量赋值
    -   let a=10+20
-   将命令赋值给变量
    -   l=ls
-   将命令结果赋值给变量，使用`$()`或者``
    -   `let c = $(ls -l /etc)`
-   变量值有空格等特殊字符可以包含在 "" 或 '' 中

## 变量的引用

-   `${变量名}`称作对变量的引用
-   `echo ${变量名}` 查看变量的值
-   `${变量名}` 在部分情况下可以省略为 `$变量名`

## 变量的作用范围

变量的作用范围只针对当前shell

变量导出(子进程可以使用)

-   export

变量删除

-   unset

## 系统环境变量

```bash
$? # 可以获取上一次执行的命令执行结果，0为正常。
$$ # 获取当前进程的PID
$O # 当前进程的名称
```

# 命令行参数

```bash
$1 # 第一个变量
$2 # 第二个变量
...
${10} # 第10个变量

${n-_} #读取第n个变量，如果为空则为_，不为空则是原有值，括号不能省略

$0 # 脚本名称
$# # 代表位置参数的数量
$* 和 $@ 代表所有位置参数
```

## 数组

定义数组：

-   `IPTS=( 10.0.0.1 10.0.0.2 10.0.0.3 )`

显示数组的所有元素

-   `echo ${IPTS[@]}`

显示数组元素个数

-   `echo ${#IPTS[@]}`

显示数组的第一个元素

-   `echo ${IPTS[0]}`

## 转义与引用

-   特殊字符
    -   `#` 注释
    -   `;` 分号
    -   `\\`转义符号
    -   `"`和`'`引号, 反引号```
-   转义
    -   `\\n \\r \\t` 单个字母的转义
    -   `\\$ \\" \\\\` 单个非字母的转义
-   引用
    -   `"` 双引号- 不完全引用，双引号里可以使用变量，例如 echo "$a" 会输出a的值
    -   `'` 单引号- 完全引用，echo '$a' 会输出 $a 的字符串
    

## 运算符

赋值运算符

-   = 赋值运算符，用于算数赋值和字符串赋值
-   使用 unset 取消为变量的赋值
-   = 除了作为赋值运算符还可以作为测试操作符

基本运算符

-   -   -   -   / **(乘方) %
-   使用 expr 进行运算
    -   `expr 4 + 5` (符号两侧要有空格 不支持浮点数)
    -   `num1 =` expr 4+5``
-   数字常量的使用方法
    -   let 变量名=变量值
    -   变量值使用 0 开头为八进制
    -   变量值使用 0x 开头为十六进制
-   双圆括号是let命令的简化
    -   ((a=10))
    -   ((a++))
    -   echo $((10+20))

# 特殊符号：

-   `{}` 花括号
    -   输出范围 echo {0...9}
    -   文件复制 `cp /etc/password{,.bak}`
-   `[][[]]` 方括号
    -   单独使用方括号是测试(test)或数组y
    -   两个方括号表示测试表达式
-   `#` 注释符
-   ; 命令分隔符
    -   case 语句的分隔符要转义 ;;
-   : 空指令
-   . 和source命令相同
-   , 分割目录
-   -   通配符
-   ? 条件测试 或 通配符
-   $ 取值符号
-   ｜管道符
-   & 后台运行
-   _ 空格

退出程序：

-   exit n 退出程序，n为空则以0退出，也可以以指定数字退出

# 测试命令test

test命令用于检查文件或者比较值

test可以做一些测试

-   文件测试
-   整数比较测试
-   字符串测试

test测试语句可以简化为[]符号

[ ] 符号还有扩展写法[[]]支持 `&&` `||` `<` `>`

```bash
test -f filename # 判断是否存在并且是文件
[ -d dir-path ] # 判断是否存在并且是文件
[ -e name ] # 判断是否存在，不关心文件格式
[ 5 > 4 ] 不能使用，结果错误，如果需要使用则应该使用双括号 [[ 5 > 4 ]] 
	或者使用 -gt 大于 -lt 小于 -eq 等于 -ge 大于等于 -le 小于等于
[ "a"="a" ] 判断字符串是否相同，区分大小写
```

# IF判断语句

```bash
if [测试条件成立]
then # if判断成立执行
	if [测试条件]
	then # 嵌套
	fi
elif [测试条件成立]
then # elif的判断成立后执行
else # 测试条件不成立，执行相应命令
fi # 结束
```

# CASE、SELECT语句

```bash
case "$1" in
	"start|START" )
		echo $0 start....
	;;
	"stop|STOP" )
		echo $0 stop..
	;;
	* )
		echo error parameter
	;; # 相当于break，需要两个分号
esac
```

# 循环

## for

```bash
# 将所有的mp3文件改成mp4
for filename in `ls *.mp3`
do
	mv $filename $(basename $filename .mp3).mp4
done
```

## while

```bash
while test测试是否成立
do
	命令
done
```

## util

util循环与while循环相反，循环测试为假时，执行循环，为真时循环停止

```bash
util test测试是否成立
do
	命令
done
```

break 跳出循环

continue 跳过本次循环

# 信号

-   kill 默认会发送15号信号给应用程序
-   ctrl+c发送2信号给应用程序
-   9号信号不可阻塞

```bash
#!/bin/bash
trap "echo sig 15" 15 # 捕获15号信号
trap "echo sig 2" 2 # 捕获2号信号
echo $$ # 显示进程号
```